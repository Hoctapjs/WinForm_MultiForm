

  GO
  CREATE FUNCTION FUN_LAYKHUYENMAI_BETWEEN ()
  RETURNS TABLE
  RETURN (SELECT MAKM, TENKM FROM CHUONGTRINH_KHUYENMAI WHERE GETDATE() BETWEEN NGAYBD AND NGAYKT)
GO
	SELECT * FROM FUN_LAYKHUYENMAI_BETWEEN()
  GO
  CREATE FUNCTION FUN_LAYKHUYENMAI_KO ()
  RETURNS TABLE
  RETURN (SELECT MAKM, TENKM FROM CHUONGTRINH_KHUYENMAI WHERE NGAYBD IS NULL AND NGAYKT IS NULL)
  GO
SELECT * FROM FUN_LAYKHUYENMAI_KO()
  GO
SELECT * FROM FUN_LAYMAKHUYENMAI()

  GO
  ALTER FUNCTION FUN_LAYMAKHUYENMAI()
  RETURNS INT
  AS
  BEGIN
  		DECLARE @KQ INT
		IF EXISTS(SELECT * FROM FUN_LAYKHUYENMAI_BETWEEN())
		BEGIN
			SET @KQ = 1
		END
		ELSE
		BEGIN
			SET @KQ = 0
		END

		RETURN @KQ
  END

  GO
  ALTER FUNCTION FUN_LAYMAKM_TABLE (@KQ INT)
RETURNS @ResultTable TABLE (
    MAKM INT,
    TENKM NVARCHAR(100)
)
AS
BEGIN
    IF @KQ = 0
    BEGIN
        -- Lấy tất cả nhân viên
        INSERT INTO @ResultTable
        SELECT * FROM FUN_LAYKHUYENMAI_KO()
    END
    ELSE
    BEGIN
        -- Lấy nhân viên theo DepartmentId cụ thể
        INSERT INTO @ResultTable
        SELECT * FROM FUN_LAYKHUYENMAI_BETWEEN()
    END

    RETURN;
END;
GO
DECLARE @KQ INT
SET @KQ = dbo.FUN_LAYMAKHUYENMAI()
SELECT * FROM FUN_LAYMAKM_TABLE(@KQ)



 



  GO



  